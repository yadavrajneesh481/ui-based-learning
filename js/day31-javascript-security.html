<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 31: JavaScript Security</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid #dc3545;
        }
        h1, h2, h3 {
            color: #dc3545;
        }
        section {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #dc3545;
            background: #f9f9f9;
        }
        .demo {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            background: white;
        }
        button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
        }
        button:hover {
            background: #c82333;
        }
        button.safe {
            background: #28a745;
        }
        button.safe:hover {
            background: #218838;
        }
        .vulnerability-card {
            background: white;
            border: 2px solid #dc3545;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s;
        }
        .vulnerability-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .vulnerability-card h4 {
            margin-top: 0;
            color: #dc3545;
        }
        .code-example {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        .security-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .safe-code {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        .unsafe-code {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .home-link {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 15px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }
        .home-link:hover {
            background: #218838;
        }
        .interview-section {
            background: #e9ecef;
            padding: 20px;
            margin-top: 30px;
        }
        .question {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
        input, textarea {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 100%;
            max-width: 400px;
        }
        .csp-demo {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #007bff;
        }
        .security-checklist {
            background: #f0f8e7;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .security-checklist ul {
            list-style-type: none;
            padding: 0;
        }
        .security-checklist li {
            padding: 5px 0;
            position: relative;
            padding-left: 25px;
        }
        .security-checklist li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .security-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="home-link" aria-label="Return to JavaScript course homepage">üè† Back to Course Home</a>
        
        <header>
            <h1>Day 31: JavaScript Security</h1>
            <p><em>Common vulnerabilities (XSS, CSRF), input sanitization, Content Security Policy</em></p>
        </header>

        <section id="intro">
            <h2>JavaScript Security Kya Hai?</h2>
            <p>Web security ek critical aspect hai modern web development mein. JavaScript applications vulnerable ho sakte hain various attacks ke liye agar proper security measures implement nahi kiye jaayein. Aaj hum common vulnerabilities aur unke prevention techniques seekhenge.</p>
            
            <h3>üîí Security Fundamentals:</h3>
            <div class="security-checklist">
                <h4>Key Security Principles:</h4>
                <ul>
                    <li>Never trust user input</li>
                    <li>Validate and sanitize all data</li>
                    <li>Use HTTPS everywhere</li>
                    <li>Implement proper authentication</li>
                    <li>Follow principle of least privilege</li>
                    <li>Keep dependencies updated</li>
                    <li>Use Content Security Policy (CSP)</li>
                </ul>
            </div>
        </section>

        <section id="xss">
            <h2>Cross-Site Scripting (XSS) Attacks</h2>
            <p>XSS sabse common web vulnerability hai jahan attacker malicious scripts inject karta hai web pages mein. Yeh user ke browser mein execute hote hain aur sensitive data steal kar sakte hain.</p>
            
            <h3>XSS Types:</h3>
            <div class="security-grid">
                <div class="vulnerability-card">
                    <h4>üî¥ Reflected XSS</h4>
                    <p><strong>Description:</strong> Malicious script URL parameters mein send kiya jaata hai</p>
                    <p><strong>Example:</strong> ?search=&lt;script&gt;alert('XSS')&lt;/script&gt;</p>
                    <p><strong>Impact:</strong> Immediate execution, phishing attacks</p>
                </div>
                <div class="vulnerability-card">
                    <h4>üî¥ Stored XSS</h4>
                    <p><strong>Description:</strong> Malicious script database mein store ho jaata hai</p>
                    <p><strong>Example:</strong> Comment mein script inject karna</p>
                    <p><strong>Impact:</strong> Persistent attack, affects all users</p>
                </div>
                <div class="vulnerability-card">
                    <h4>üî¥ DOM-based XSS</h4>
                    <p><strong>Description:</strong> Client-side JavaScript mein vulnerability</p>
                    <p><strong>Example:</strong> innerHTML se unsafe content add karna</p>
                    <p><strong>Impact:</strong> Browser-level attack</p>
                </div>
            </div>
            
            <div class="demo">
                <h3>XSS Vulnerability Demo</h3>
                <p><strong>‚ö†Ô∏è Warning:</strong> Yeh educational purpose ke liye hai. Real applications mein kabhi aise code na likhein!</p>
                
                <h4>Vulnerable Code (Don't Use):</h4>
                <div class="code-example unsafe-code">
// ‚ùå UNSAFE - Direct innerHTML usage
function displayUserInput() {
    const userInput = document.getElementById('user-input').value;
    document.getElementById('output').innerHTML = userInput; // XSS vulnerability!
}
                </div>
                
                <h4>Safe Code (Use This):</h4>
                <div class="code-example safe-code">
// ‚úÖ SAFE - Proper sanitization
function displayUserInputSafe() {
    const userInput = document.getElementById('user-input-safe').value;
    // Use textContent instead of innerHTML
    document.getElementById('output-safe').textContent = userInput;
    
    // Or use proper sanitization library
    // document.getElementById('output-safe').innerHTML = DOMPurify.sanitize(userInput);
}
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div>
                        <h4>‚ùå Vulnerable Version:</h4>
                        <input type="text" id="user-input" placeholder="Try: &lt;img src=x onerror=alert('XSS')&gt;">
                        <button onclick="displayUserInput()">Display (Unsafe)</button>
                        <div id="output" style="border: 1px solid #dc3545; padding: 10px; margin-top: 10px; min-height: 50px;"></div>
                    </div>
                    <div>
                        <h4>‚úÖ Safe Version:</h4>
                        <input type="text" id="user-input-safe" placeholder="Try: &lt;img src=x onerror=alert('XSS')&gt;">
                        <button class="safe" onclick="displayUserInputSafe()">Display (Safe)</button>
                        <div id="output-safe" style="border: 1px solid #28a745; padding: 10px; margin-top: 10px; min-height: 50px;"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="csrf">
            <h2>Cross-Site Request Forgery (CSRF)</h2>
            <p>CSRF attack mein attacker user ko trick karta hai unwanted actions perform karne ke liye authenticated website pe. User ko pata bhi nahi chalta ki unka account misuse ho raha hai.</p>
            
            <div class="demo">
                <h3>CSRF Attack Simulation</h3>
                <p>Imagine karo tum bank website pe logged in ho. Attacker tumhein ek malicious link send karta hai:</p>
                
                <div class="code-example unsafe-code">
<!-- ‚ùå Malicious form that submits automatically -->
&lt;form action="https://bank.com/transfer" method="POST" id="malicious-form"&gt;
    &lt;input type="hidden" name="to" value="attacker-account"&gt;
    &lt;input type="hidden" name="amount" value="10000"&gt;
&lt;/form&gt;
&lt;script&gt;
    document.getElementById('malicious-form').submit(); // Auto-submit!
&lt;/script&gt;
                </div>
                
                <h4>CSRF Protection Methods:</h4>
                <div class="security-grid">
                    <div class="vulnerability-card" style="border-color: #28a745;">
                        <h4>üõ°Ô∏è CSRF Tokens</h4>
                        <p>Har form mein unique token add karo</p>
                        <div class="code-example safe-code">
&lt;input type="hidden" name="csrf_token" value="abc123xyz"&gt;
                        </div>
                    </div>
                    <div class="vulnerability-card" style="border-color: #28a745;">
                        <h4>üõ°Ô∏è SameSite Cookies</h4>
                        <p>Cookies ko cross-site requests mein send na karo</p>
                        <div class="code-example safe-code">
Set-Cookie: sessionid=abc123; SameSite=Strict
                        </div>
                    </div>
                    <div class="vulnerability-card" style="border-color: #28a745;">
                        <h4>üõ°Ô∏è Origin Validation</h4>
                        <p>Request origin ko verify karo</p>
                        <div class="code-example safe-code">
if (request.headers.origin !== 'https://mysite.com') {
    return reject();
}
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="input-sanitization">
            <h2>Input Sanitization & Escaping</h2>
            <p>User input ko sanitize karna security ka first line of defense hai. Kabhi bhi user input pe trust nahi karna chahiye.</p>
            
            <div class="demo">
                <h3>Input Sanitization Techniques</h3>
                
                <h4>1. HTML Escaping:</h4>
                <div class="code-example safe-code">
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Usage
const userInput = "&lt;script&gt;alert('xss')&lt;/script&gt;";
const safeOutput = escapeHtml(userInput);
// Result: "&amp;lt;script&amp;gt;alert('xss')&amp;lt;/script&amp;gt;"
                </div>
                
                <h4>2. Input Validation:</h4>
                <div class="code-example safe-code">
function validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

function validateInput(input, type) {
    switch(type) {
        case 'email':
            return validateEmail(input);
        case 'number':
            return !isNaN(input) && isFinite(input);
        case 'alphanumeric':
            return /^[a-zA-Z0-9]+$/.test(input);
        default:
            return false;
    }
}
                </div>
                
                <h4>Interactive Sanitization Demo:</h4>
                <div style="margin: 20px 0;">
                    <textarea id="raw-input" placeholder="Enter potentially malicious input..." rows="3"></textarea><br>
                    <button onclick="sanitizeInput()">üßπ Sanitize Input</button>
                    <button onclick="validateInputDemo()">‚úÖ Validate Input</button>
                </div>
                <div id="sanitization-result"></div>
            </div>
        </section>

        <section id="csp">
            <h2>Content Security Policy (CSP)</h2>
            <p>CSP ek security header hai jo browser ko batata hai ki kaun se resources load karne allowed hain. Yeh XSS attacks ko prevent karne mein help karta hai.</p>
            
            <div class="csp-demo">
                <h3>CSP Header Examples:</h3>
                <div class="code-example">
<!-- Basic CSP -->
Content-Security-Policy: default-src 'self'

<!-- Allow specific domains -->
Content-Security-Policy: default-src 'self'; script-src 'self' https://cdn.example.com

<!-- Strict CSP -->
Content-Security-Policy: 
    default-src 'none';
    script-src 'self' 'nonce-abc123';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: https:;
    connect-src 'self';
    font-src 'self';
                </div>
                
                <h4>CSP Directives:</h4>
                <ul>
                    <li><strong>default-src:</strong> Default policy for all resource types</li>
                    <li><strong>script-src:</strong> JavaScript sources</li>
                    <li><strong>style-src:</strong> CSS sources</li>
                    <li><strong>img-src:</strong> Image sources</li>
                    <li><strong>connect-src:</strong> AJAX, WebSocket connections</li>
                    <li><strong>font-src:</strong> Font sources</li>
                </ul>
            </div>
            
            <div class="demo">
                <h3>CSP Generator Tool</h3>
                <div style="margin: 15px 0;">
                    <label><input type="checkbox" id="csp-self"> Allow 'self'</label><br>
                    <label><input type="checkbox" id="csp-inline"> Allow inline scripts (unsafe)</label><br>
                    <label><input type="checkbox" id="csp-eval"> Allow eval() (unsafe)</label><br>
                    <label>External domains: <input type="text" id="csp-domains" placeholder="https://cdn.example.com"></label><br>
                </div>
                <button onclick="generateCSP()">Generate CSP Header</button>
                <div id="csp-output"></div>
            </div>
        </section>

        <section id="secure-form">
            <h2>Practice: Secure Form Submission</h2>
            <p>Ab ek complete secure form banayenge jo sabhi security best practices follow kare:</p>
            
            <div class="demo">
                <h3>Secure Contact Form</h3>
                <form id="secure-form" onsubmit="return submitSecureForm(event)">
                    <div style="margin: 10px 0;">
                        <label>Name: <input type="text" id="secure-name" required maxlength="50"></label>
                        <span id="name-error" style="color: #dc3545; font-size: 0.8em;"></span>
                    </div>
                    <div style="margin: 10px 0;">
                        <label>Email: <input type="email" id="secure-email" required></label>
                        <span id="email-error" style="color: #dc3545; font-size: 0.8em;"></span>
                    </div>
                    <div style="margin: 10px 0;">
                        <label>Message: <textarea id="secure-message" required maxlength="500" rows="4"></textarea></label>
                        <span id="message-error" style="color: #dc3545; font-size: 0.8em;"></span>
                    </div>
                    <div style="margin: 10px 0;">
                        <label><input type="checkbox" id="terms" required> I agree to terms and conditions</label>
                    </div>
                    <input type="hidden" id="csrf-token" value="secure-token-123">
                    <button type="submit" class="safe">Submit Securely</button>
                </form>
                <div id="form-result"></div>
                
                <h4>Security Features Implemented:</h4>
                <div class="security-checklist">
                    <ul>
                        <li>Input validation and sanitization</li>
                        <li>CSRF token protection</li>
                        <li>Rate limiting simulation</li>
                        <li>XSS prevention</li>
                        <li>Input length restrictions</li>
                        <li>Email format validation</li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="interview-section">
            <h2>Interview Questions</h2>
            <div class="question">
                <h3>1. Basic: XSS kya hai aur yeh kaise prevent karte hain?</h3>
                <p>Answer: Cross-Site Scripting - malicious scripts inject karna. Prevention: input sanitization, output encoding, CSP headers use karna.</p>
            </div>
            <div class="question">
                <h3>2. Basic: CSRF attack kya hai?</h3>
                <p>Answer: Cross-Site Request Forgery - user ko trick karke unwanted actions perform karana. Prevention: CSRF tokens, SameSite cookies.</p>
            </div>
            <div class="question">
                <h3>3. Intermediate: innerHTML vs textContent security mein kya difference hai?</h3>
                <p>Answer: innerHTML HTML execute karta hai (XSS risk), textContent sirf text set karta hai (safe).</p>
            </div>
            <div class="question">
                <h3>4. Intermediate: Content Security Policy (CSP) kya hai?</h3>
                <p>Answer: HTTP header jo browser ko batata hai kaun se resources load karne allowed hain. XSS prevention ke liye use hota hai.</p>
            </div>
            <div class="question">
                <h3>5. Advanced: Input sanitization ke different methods kya hain?</h3>
                <p>Answer: HTML escaping, input validation, whitelist filtering, DOMPurify library, server-side validation.</p>
            </div>
            <div class="question">
                <h3>6. Advanced: Same-origin policy kya hai aur kaise bypass hoti hai?</h3>
                <p>Answer: Browser security feature jo cross-origin requests restrict karta hai. CORS, JSONP, postMessage se bypass kar sakte hain.</p>
            </div>
        </section>
    </div>

    <script>
        // XSS Demo Functions
        function displayUserInput() {
            const userInput = document.getElementById('user-input').value;
            // ‚ö†Ô∏è UNSAFE - for demonstration only
            document.getElementById('output').innerHTML = userInput;
        }

        function displayUserInputSafe() {
            const userInput = document.getElementById('user-input-safe').value;
            // ‚úÖ SAFE - using textContent
            document.getElementById('output-safe').textContent = userInput;
        }

        // Input Sanitization Functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function validateInput(input, type) {
            switch(type) {
                case 'email':
                    return validateEmail(input);
                case 'number':
                    return !isNaN(input) && isFinite(input);
                case 'alphanumeric':
                    return /^[a-zA-Z0-9\s]+$/.test(input);
                default:
                    return input.length > 0;
            }
        }

        function sanitizeInput() {
            const rawInput = document.getElementById('raw-input').value;
            const escaped = escapeHtml(rawInput);
            
            document.getElementById('sanitization-result').innerHTML = `
                <h4>Sanitization Results:</h4>
                <p><strong>Original:</strong> ${rawInput}</p>
                <p><strong>Escaped:</strong> ${escaped}</p>
                <p><strong>Safe for display:</strong> ‚úÖ</p>
            `;
        }

        function validateInputDemo() {
            const rawInput = document.getElementById('raw-input').value;
            const isValidEmail = validateEmail(rawInput);
            const isValidAlphanumeric = validateInput(rawInput, 'alphanumeric');
            const isValidNumber = validateInput(rawInput, 'number');
            
            document.getElementById('sanitization-result').innerHTML = `
                <h4>Validation Results:</h4>
                <p><strong>Input:</strong> ${rawInput}</p>
                <p><strong>Valid Email:</strong> ${isValidEmail ? '‚úÖ' : '‚ùå'}</p>
                <p><strong>Valid Alphanumeric:</strong> ${isValidAlphanumeric ? '‚úÖ' : '‚ùå'}</p>
                <p><strong>Valid Number:</strong> ${isValidNumber ? '‚úÖ' : '‚ùå'}</p>
            `;
        }

        // CSP Generator
        function generateCSP() {
            let csp = "Content-Security-Policy: ";
            let directives = [];
            
            if (document.getElementById('csp-self').checked) {
                directives.push("default-src 'self'");
            } else {
                directives.push("default-src 'none'");
            }
            
            let scriptSrc = "script-src 'self'";
            if (document.getElementById('csp-inline').checked) {
                scriptSrc += " 'unsafe-inline'";
            }
            if (document.getElementById('csp-eval').checked) {
                scriptSrc += " 'unsafe-eval'";
            }
            
            const domains = document.getElementById('csp-domains').value;
            if (domains) {
                scriptSrc += " " + domains;
            }
            
            directives.push(scriptSrc);
            directives.push("style-src 'self' 'unsafe-inline'");
            directives.push("img-src 'self' data: https:");
            
            csp += directives.join('; ');
            
            document.getElementById('csp-output').innerHTML = `
                <h4>Generated CSP Header:</h4>
                <div class="code-example">${csp}</div>
                <p><strong>Security Level:</strong> ${
                    document.getElementById('csp-inline').checked || document.getElementById('csp-eval').checked 
                    ? '‚ö†Ô∏è Medium (unsafe directives used)' 
                    : 'üõ°Ô∏è High (secure configuration)'
                }</p>
            `;
        }

        // Secure Form Submission
        let submissionCount = 0;
        const maxSubmissions = 3;

        function submitSecureForm(event) {
            event.preventDefault();
            
            // Rate limiting
            if (submissionCount >= maxSubmissions) {
                document.getElementById('form-result').innerHTML = `
                    <div style="color: #dc3545; padding: 10px; background: #f8d7da; border-radius: 5px; margin-top: 10px;">
                        ‚ùå Rate limit exceeded. Please try again later.
                    </div>
                `;
                return false;
            }
            
            // Clear previous errors
            document.getElementById('name-error').textContent = '';
            document.getElementById('email-error').textContent = '';
            document.getElementById('message-error').textContent = '';
            
            // Get form data
            const name = document.getElementById('secure-name').value.trim();
            const email = document.getElementById('secure-email').value.trim();
            const message = document.getElementById('secure-message').value.trim();
            const csrfToken = document.getElementById('csrf-token').value;
            
            let isValid = true;
            
            // Validate name
            if (!validateInput(name, 'alphanumeric') || name.length < 2) {
                document.getElementById('name-error').textContent = 'Name must be at least 2 characters and contain only letters/numbers';
                isValid = false;
            }
            
            // Validate email
            if (!validateEmail(email)) {
                document.getElementById('email-error').textContent = 'Please enter a valid email address';
                isValid = false;
            }
            
            // Validate message
            if (message.length < 10) {
                document.getElementById('message-error').textContent = 'Message must be at least 10 characters long';
                isValid = false;
            }
            
            if (!isValid) {
                return false;
            }
            
            // Simulate secure submission
            submissionCount++;
            
            // Sanitize data for display
            const sanitizedData = {
                name: escapeHtml(name),
                email: escapeHtml(email),
                message: escapeHtml(message)
            };
            
            document.getElementById('form-result').innerHTML = `
                <div style="color: #28a745; padding: 15px; background: #d4edda; border-radius: 5px; margin-top: 10px;">
                    ‚úÖ Form submitted securely!<br>
                    <strong>Security measures applied:</strong><br>
                    ‚Ä¢ Input validation ‚úì<br>
                    ‚Ä¢ HTML escaping ‚úì<br>
                    ‚Ä¢ CSRF token verified ‚úì<br>
                    ‚Ä¢ Rate limiting active (${submissionCount}/${maxSubmissions})<br>
                    <br>
                    <strong>Sanitized data:</strong><br>
                    Name: ${sanitizedData.name}<br>
                    Email: ${sanitizedData.email}<br>
                    Message: ${sanitizedData.message.substring(0, 50)}...
                </div>
            `;
            
            // Reset form
            document.getElementById('secure-form').reset();
            
            return false;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîí Day 31: JavaScript Security loaded!');
            console.log('‚ö†Ô∏è Remember: Security is everyone\'s responsibility!');
        });
    </script>
</body>
</html>